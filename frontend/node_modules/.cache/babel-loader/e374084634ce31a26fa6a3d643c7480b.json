{"ast":null,"code":"// Header\nimport HeaderLog from \"@/components/HeaderLog.vue\"; // Axios\n\nconst axios = require(\"axios\");\n\nconst instance = axios.create({\n  baseURL: \"http://localhost:3000/api/\"\n});\nexport default {\n  name: \"LoginView\",\n  props: [\"\"],\n\n  data() {\n    return {\n      titre: \"Se connecter\",\n      email: \"\",\n      password: \"\",\n      emailDisplayed: false,\n      passwordDisplayed: false,\n      errorMessage: null,\n      sessionToken: null\n    };\n  },\n\n  methods: {\n    // Vérification Regex + gestion affichage message d'erreur\n    analyseEmail: function () {\n      let regEmail = new RegExp(\"[a-z0-9]+@[a-z]+[.]+[a-z]{2,3}\");\n      let testEmail = regEmail.exec(this.email);\n\n      if (testEmail) {\n        this.emailDisplayed = false;\n      } else {\n        this.emailDisplayed = true;\n      }\n    },\n    // Vérification présence mot de passe et gestion affichage message d'erreur\n    checkPassword: function () {\n      if (this.password != \"\") {\n        this.passwordDisplayed = false;\n      } else {\n        this.passwordDisplayed = true;\n      }\n    },\n    // Vérification de tous les champs et gestion activation/désactivation du bouton \"se connecter\"\n    validatedFields: function () {\n      let regEmail = new RegExp(\"[a-z0-9]+@[a-z]+[.]+[a-z]{2,3}\");\n      let testEmail = regEmail.exec(this.email);\n\n      if (testEmail && this.password != \"\") {\n        return true;\n      } else {\n        return false;\n      }\n    },\n    // Envoi API - connection utilisateur déjà existant\n    loginAccount: function () {\n      let userInfos = {\n        email: this.email,\n        password: this.password\n      };\n      instance.post(\"auth/login\", userInfos).then(response => {\n        this.$store.commit(\"myToken\", response.data.token); // Récupération du token dans le state\n\n        this.$store.commit(\"myId\", response.data.userId); // Récupération du userId dans le state\n\n        this.$router.push(\"/\"); // Redirection vers accueil\n\n        if (response.data.isAdmin == true) {\n          this.$store.state.adminProfil = true;\n          console.log(\"true : \" + this.$store.state.adminProfil);\n        } else {\n          this.$store.state.adminProfil = true;\n          console.log(\"false : \" + this.$store.state.adminProfil);\n        }\n      }).catch(error => {\n        console.log(error);\n        this.errorMessage = error.response.data.error; // Affichage du message d'erreur\n      });\n    }\n  },\n  components: {\n    HeaderLog\n  }\n};","map":{"version":3,"mappings":"AAmDA;AACA,OAAOA,SAAP,MAAsB,4BAAtB,C,CAEA;;AACA,MAAMC,KAAI,GAAIC,OAAO,CAAC,OAAD,CAArB;;AACA,MAAMC,QAAO,GAAIF,KAAK,CAACG,MAAN,CAAa;AAC5BC,SAAO,EAAE;AADmB,CAAb,CAAjB;AAIA,eAAe;AACbC,MAAI,EAAE,WADO;AAEbC,OAAK,EAAE,CAAC,EAAD,CAFM;;AAGbC,MAAI,GAAG;AACL,WAAO;AACLC,WAAK,EAAE,cADF;AAELC,WAAK,EAAE,EAFF;AAGLC,cAAQ,EAAE,EAHL;AAILC,oBAAc,EAAE,KAJX;AAKLC,uBAAiB,EAAE,KALd;AAMLC,kBAAY,EAAE,IANT;AAOLC,kBAAY,EAAE;AAPT,KAAP;AASD,GAbY;;AAcbC,SAAO,EAAE;AACP;AACAC,gBAAY,EAAE,YAAY;AACxB,UAAIC,QAAO,GAAI,IAAIC,MAAJ,CAAW,gCAAX,CAAf;AACA,UAAIC,SAAQ,GAAIF,QAAQ,CAACG,IAAT,CAAc,KAAKX,KAAnB,CAAhB;;AACA,UAAIU,SAAJ,EAAe;AACb,aAAKR,cAAL,GAAsB,KAAtB;AACF,OAFA,MAEO;AACL,aAAKA,cAAL,GAAsB,IAAtB;AACF;AACD,KAVM;AAYP;AACAU,iBAAa,EAAE,YAAY;AACzB,UAAI,KAAKX,QAAL,IAAiB,EAArB,EAAyB;AACvB,aAAKE,iBAAL,GAAyB,KAAzB;AACF,OAFA,MAEO;AACL,aAAKA,iBAAL,GAAyB,IAAzB;AACF;AACD,KAnBM;AAqBP;AACAU,mBAAe,EAAE,YAAY;AAC3B,UAAIL,QAAO,GAAI,IAAIC,MAAJ,CAAW,gCAAX,CAAf;AACA,UAAIC,SAAQ,GAAIF,QAAQ,CAACG,IAAT,CAAc,KAAKX,KAAnB,CAAhB;;AAEA,UAAIU,SAAQ,IAAK,KAAKT,QAAL,IAAiB,EAAlC,EAAsC;AACpC,eAAO,IAAP;AACF,OAFA,MAEO;AACL,eAAO,KAAP;AACF;AACD,KA/BM;AAiCP;AACAa,gBAAY,EAAE,YAAY;AACxB,UAAIC,SAAQ,GAAI;AACdf,aAAK,EAAE,KAAKA,KADE;AAEdC,gBAAQ,EAAE,KAAKA;AAFD,OAAhB;AAKAR,cAAO,CACJuB,IADH,CACQ,YADR,EACsBD,SADtB,EAEGE,IAFH,CAESC,QAAD,IAAc;AAClB,aAAKC,MAAL,CAAYC,MAAZ,CAAmB,SAAnB,EAA8BF,QAAQ,CAACpB,IAAT,CAAcuB,KAA5C,EADkB,CACkC;;AACpD,aAAKF,MAAL,CAAYC,MAAZ,CAAmB,MAAnB,EAA2BF,QAAQ,CAACpB,IAAT,CAAcwB,MAAzC,EAFkB,CAEgC;;AAClD,aAAKC,OAAL,CAAaC,IAAb,CAAkB,GAAlB,EAHkB,CAGM;;AACxB,YAAIN,QAAQ,CAACpB,IAAT,CAAc2B,OAAd,IAAyB,IAA7B,EAAmC;AACjC,eAAKN,MAAL,CAAYO,KAAZ,CAAkBC,WAAlB,GAAgC,IAAhC;AACAC,iBAAO,CAACC,GAAR,CAAY,YAAY,KAAKV,MAAL,CAAYO,KAAZ,CAAkBC,WAA1C;AACF,SAHA,MAGO;AACL,eAAKR,MAAL,CAAYO,KAAZ,CAAkBC,WAAlB,GAAgC,IAAhC;AACAC,iBAAO,CAACC,GAAR,CAAY,aAAa,KAAKV,MAAL,CAAYO,KAAZ,CAAkBC,WAA3C;AACF;AACD,OAbH,EAcGG,KAdH,CAcUC,KAAD,IAAW;AAChBH,eAAO,CAACC,GAAR,CAAYE,KAAZ;AACA,aAAK3B,YAAL,GAAoB2B,KAAK,CAACb,QAAN,CAAepB,IAAf,CAAoBiC,KAAxC,CAFgB,CAE+B;AAChD,OAjBH;AAkBD;AA1DM,GAdI;AA0EbC,YAAU,EAAE;AAAE1C;AAAF;AA1EC,CAAf","names":["HeaderLog","axios","require","instance","create","baseURL","name","props","data","titre","email","password","emailDisplayed","passwordDisplayed","errorMessage","sessionToken","methods","analyseEmail","regEmail","RegExp","testEmail","exec","checkPassword","validatedFields","loginAccount","userInfos","post","then","response","$store","commit","token","userId","$router","push","isAdmin","state","adminProfil","console","log","catch","error","components"],"sourceRoot":"","sources":["/Users/clemencebonneaud/Desktop/Dev/OpenClassrooms/Cours/OC_P7/code/frontend/groupomania-v1.0/src/views/LoginView.vue"],"sourcesContent":["<!-- ////////////////////////////////////////////////// -->\n<!--                      TEMPLATE                      -->\n<!-- ////////////////////////////////////////////////// -->\n\n<template>\n  <div class=\"signup\">\n    <!-- Header -->\n    <HeaderLog />\n\n    <h1>{{ titre }}</h1>\n\n    <!-- Formulaire -->\n    <div class=\"bloc\">\n      <form>\n        <label>Email</label>\n        <input v-model=\"email\" type=\"email\" @keyup=\"analyseEmail()\" />\n        <!-- Message qui apparaît si le champ est mal rempli -->\n        <p class=\"formMessage\" v-if=\"emailDisplayed\">\n          Veuillez saisir un email valide\n        </p>\n\n        <label>Mot de passe</label>\n        <input v-model=\"password\" type=\"password\" @change=\"checkPassword()\" />\n        <p class=\"formMessage\" v-if=\"passwordDisplayed\">\n          Veuillez saisir un mot de passe\n        </p>\n      </form>\n\n      <!-- Message d'erreur en cas d'erreur côté serveur -->\n      <p v-if=\"errorMessage\" class=\"errorMessage\">\n        Oups ! Il semble que {{ errorMessage }}\n      </p>\n\n      <!-- Bouton désactivé -->\n      <button v-if=\"!validatedFields()\" class=\"bouton bouton--disabled\">\n        Se connecter\n      </button>\n\n      <!-- Bouton activé -->\n      <button v-if=\"validatedFields()\" class=\"bouton\" @click=\"loginAccount()\">\n        Se connecter\n      </button>\n    </div>\n  </div>\n</template>\n\n<!-- ////////////////////////////////////////////////// -->\n<!--                       SCRIPT                       -->\n<!-- ////////////////////////////////////////////////// -->\n\n<script>\n// Header\nimport HeaderLog from \"@/components/HeaderLog.vue\";\n\n// Axios\nconst axios = require(\"axios\");\nconst instance = axios.create({\n  baseURL: \"http://localhost:3000/api/\",\n});\n\nexport default {\n  name: \"LoginView\",\n  props: [\"\"],\n  data() {\n    return {\n      titre: \"Se connecter\",\n      email: \"\",\n      password: \"\",\n      emailDisplayed: false,\n      passwordDisplayed: false,\n      errorMessage: null,\n      sessionToken: null,\n    };\n  },\n  methods: {\n    // Vérification Regex + gestion affichage message d'erreur\n    analyseEmail: function () {\n      let regEmail = new RegExp(\"[a-z0-9]+@[a-z]+[.]+[a-z]{2,3}\");\n      let testEmail = regEmail.exec(this.email);\n      if (testEmail) {\n        this.emailDisplayed = false;\n      } else {\n        this.emailDisplayed = true;\n      }\n    },\n\n    // Vérification présence mot de passe et gestion affichage message d'erreur\n    checkPassword: function () {\n      if (this.password != \"\") {\n        this.passwordDisplayed = false;\n      } else {\n        this.passwordDisplayed = true;\n      }\n    },\n\n    // Vérification de tous les champs et gestion activation/désactivation du bouton \"se connecter\"\n    validatedFields: function () {\n      let regEmail = new RegExp(\"[a-z0-9]+@[a-z]+[.]+[a-z]{2,3}\");\n      let testEmail = regEmail.exec(this.email);\n\n      if (testEmail && this.password != \"\") {\n        return true;\n      } else {\n        return false;\n      }\n    },\n\n    // Envoi API - connection utilisateur déjà existant\n    loginAccount: function () {\n      let userInfos = {\n        email: this.email,\n        password: this.password,\n      };\n\n      instance\n        .post(\"auth/login\", userInfos)\n        .then((response) => {\n          this.$store.commit(\"myToken\", response.data.token); // Récupération du token dans le state\n          this.$store.commit(\"myId\", response.data.userId); // Récupération du userId dans le state\n          this.$router.push(\"/\"); // Redirection vers accueil\n          if (response.data.isAdmin == true) {\n            this.$store.state.adminProfil = true;\n            console.log(\"true : \" + this.$store.state.adminProfil);\n          } else {\n            this.$store.state.adminProfil = true;\n            console.log(\"false : \" + this.$store.state.adminProfil);\n          }\n        })\n        .catch((error) => {\n          console.log(error);\n          this.errorMessage = error.response.data.error; // Affichage du message d'erreur\n        });\n    },\n  },\n  components: { HeaderLog },\n};\n</script>\n"]},"metadata":{},"sourceType":"module"}